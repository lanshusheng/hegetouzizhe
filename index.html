<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>投资者风险承受能力评估问卷</title>
    <!-- 引入 CryptoJS 用于生成 HMAC-SHA256 签名 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Microsoft YaHei", "Segoe UI", sans-serif;
        }
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #2c3e50;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .intro {
            background-color: #e8f4fc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 5px solid #3498db;
        }
        .disclaimer {
            background-color: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-size: 0.9em;
            border-left: 5px solid #ff9800;
        }
        .section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        .section-title {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #3498db;
            display: inline-block;
        }
        .question {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #e0e0e0;
        }
        .question:hover {
            border-left-color: #3498db;
        }
        .question-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .options {
            margin-left: 20px;
        }
        .option {
            margin-bottom: 8px;
        }
        label {
            cursor: pointer;
            display: block;
            padding: 5px 0;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .personal-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        .btn-container {
            text-align: center;
            margin: 30px 0;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .result-container {
            display: none;
            margin-top: 30px;
            padding: 25px;
            background-color: #e8f4fc;
            border-radius: 8px;
            text-align: center;
        }
        .score-display {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin: 15px 0;
        }
        .risk-level {
            font-size: 28px;
            color: #e74c3c;
            margin: 15px 0;
        }
        .match-info {
            margin-top: 20px;
            text-align: left;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        .signature {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px dashed #ccc;
        }
        .submit-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        .submit-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .submit-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        @media (max-width: 768px) {
            .personal-info {
                grid-template-columns: 1fr;
            }
            .container {
                padding: 15px;
            }
        }
        .multi-note {
            font-size: 0.9em;
            color: #e74c3c;
            margin-top: 5px;
        }
        .submit-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        .submit-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .submit-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>投资者风险承受能力评估问卷</h1>
            <p>（适用于自然人投资者）</p>
        </header>

        <div class="intro">
            <p>本问卷旨在了解您可承受的风险程度等情况，借此协助您选择合适的产品或服务类别，以符合您的风险承受能力。</p>
            <p>风险承受能力评估是本公司向投资者履行适当性义务的一个环节，其目的是使本公司所提供的产品或服务与您的风险承受能力等级相匹配。</p>
        </div>

        <div class="disclaimer">
            <p><strong>特别提醒：</strong>本公司向投资者履行风险承受能力评估等适当性义务，并不能取代您自己的投资判断，也不会降低产品或服务的固有风险。同时，与产品或服务相关的投资风险、履约责任以及费用等将由您自行承担。</p>
        </div>

        <form id="risk-assessment-form">
            <div class="personal-info">
                <div>
                    <label>投资者姓名：</label>
                    <input type="text" name="name" required>
                </div>
                <div>
                    <label>证件类型：</label>
                    <input type="text" name="id-type" required>
                </div>
                <div>
                    <label>证件号码：</label>
                    <input type="text" name="id-number" required>
                </div>
                <div>
                    <label>签署日期：</label>
                    <input type="text" name="date" required>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">一、财务状况</h2>
                
                <div class="question">
                    <div class="question-title">1. 您的主要收入来源是：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q1" value="A" required> A. 工资、劳务报酬</label></div>
                        <div class="option"><label><input type="radio" name="q1" value="B"> B. 生产经营所得</label></div>
                        <div class="option"><label><input type="radio" name="q1" value="C"> C. 利息、股息、转让证券等金融性资产收入</label></div>
                        <div class="option"><label><input type="radio" name="q1" value="D"> D. 出租、出售房地产等非金融性资产收入</label></div>
                        <div class="option"><label><input type="radio" name="q1" value="E"> E. 无固定收入</label></div>
                    </div>
                </div>

                <div class="question">
                    <div class="question-title">2. 最近您家庭预计进行证券投资的资金占家庭现有总资产(不含自住、自用房产及汽车等固定资产)的比例是：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q2" value="A" required> A. 70%以上</label></div>
                        <div class="option"><label><input type="radio" name="q2" value="B"> B. 50%-70%</label></div>
                        <div class="option"><label><input type="radio" name="q2" value="C"> C. 30%－50%</label></div>
                        <div class="option"><label><input type="radio" name="q2" value="D"> D. 10%－30%</label></div>
                        <div class="option"><label><input type="radio" name="q2" value="E"> E. 10%以下</label></div>
                    </div>
                </div>

                <div class="question">
                    <div class="question-title">3. 您是否有尚未清偿的数额较大的债务，如有，其性质是：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q3" value="A" required> A. 没有</label></div>
                        <div class="option"><label><input type="radio" name="q3" value="B"> B. 有，住房抵押贷款等长期定额债务</label></div>
                        <div class="option"><label><input type="radio" name="q3" value="C"> C. 有，信用卡欠款、消费信贷等短期信用债务</label></div>
                        <div class="option"><label><input type="radio" name="q3" value="D"> D. 有，亲朋之间借款</label></div>
                    </div>
                </div>

                <div class="question">
                    <div class="question-title">4. 您可用于投资的资产数额（包括金融资产和不动产）为：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q4" value="A" required> A. 不超过50万元人民币</label></div>
                        <div class="option"><label><input type="radio" name="q4" value="B"> B. 50万-300万元（不含）人民币</label></div>
                        <div class="option"><label><input type="radio" name="q4" value="C"> C. 300万-1000万元（不含）人民币</label></div>
                        <div class="option"><label><input type="radio" name="q4" value="D"> D. 1000万元人民币以上</label></div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">二、投资知识</h2>
                
                <div class="question">
                    <div class="question-title">5. 以下描述中何种符合您的实际情况：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q5" value="A" required> A. 现在或此前曾从事金融、经济或财会等与金融产品投资相关的工作超过两年</label></div>
                        <div class="option"><label><input type="radio" name="q5" value="B"> B. 已取得金融、经济或财会等与金融产品投资相关专业学士以上学位</label></div>
                        <div class="option"><label><input type="radio" name="q5" value="C"> C. 取得证券从业资格、基金从业资格、期货从业资格、注册会计师证书（CPA）或注册金融分析师证书（CFA）中的一项及以上</label></div>
                        <div class="option"><label><input type="radio" name="q5" value="D"> D. 我不符合以上任何一项描述</label></div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">三、投资经验</h2>
                
                <div class="question">
                    <div class="question-title">6. 您的投资经验可以被概括为：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q6" value="A" required> A. 有限：除银行活期账户和定期存款外，我基本没有其他投资经验</label></div>
                        <div class="option"><label><input type="radio" name="q6" value="B"> B. 一般：除银行活期账户和定期存款外，我购买过基金、保险等理财产品，但还需要进一步的指导</label></div>
                        <div class="option"><label><input type="radio" name="q6" value="C"> C. 丰富：我是一位有经验的投资者，参与过股票、基金等产品的交易，并倾向于自己做出投资决策</label></div>
                        <div class="option"><label><input type="radio" name="q6" value="D"> D. 非常丰富：我是一位非常有经验的投资者，参与过权证、期货或创业板等产品的交易</label></div>
                    </div>
                </div>

                <div class="question">
                    <div class="question-title">7. 有一位投资者一个月内做了15笔交易（同一品种买卖各一次算一笔），您认为这样的交易频率：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q7" value="A" required> A. 太高了</label></div>
                        <div class="option"><label><input type="radio" name="q7" value="B"> B. 偏高</label></div>
                        <div class="option"><label><input type="radio" name="q7" value="C"> C. 正常</label></div>
                        <div class="option"><label><input type="radio" name="q7" value="D"> D. 偏低</label></div>
                    </div>
                </div>

                <div class="question">
                    <div class="question-title">8. 过去一年时间内，您购买的不同产品或接受的不同服务（含同一类型的不同产品或服务）的数量是：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q8" value="A" required> A. 5个以下</label></div>
                        <div class="option"><label><input type="radio" name="q8" value="B"> B. 6至10个</label></div>
                        <div class="option"><label><input type="radio" name="q8" value="C"> C. 11至15个</label></div>
                        <div class="option"><label><input type="radio" name="q8" value="D"> D. 16个以上</label></div>
                    </div>
                </div>

                <div class="question">
                    <div class="question-title">9. 以下金融产品或服务，您投资经验在两年以上的有：</div>
                    <div class="options">
                        <div class="option"><label><input type="checkbox" name="q9" value="A"> A. 银行存款等</label></div>
                        <div class="option"><label><input type="checkbox" name="q9" value="B"> B. 债券、货币市场基金、债券型基金或其它固定收益类产品等</label></div>
                        <div class="option"><label><input type="checkbox" name="q9" value="C"> C. 股票、混合型基金、偏股型基金、股票型基金等权益类投资品种等</label></div>
                        <div class="option"><label><input type="checkbox" name="q9" value="D"> D. 期货、期权、融资融券</label></div>
                        <div class="option"><label><input type="checkbox" name="q9" value="E"> E. 复杂金融产品、其他产品或服务</label></div>
                    </div>
                    <div class="multi-note">注：本题可多选，但评分以其中最高分值选项为准。</div>
                </div>

                <div class="question">
                    <div class="question-title">10. 如果您曾经从事过金融市场投资，在交易较为活跃的月份，平均月交易额大概是多少：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q10" value="A" required> A. 10万元以内</label></div>
                        <div class="option"><label><input type="radio" name="q10" value="B"> B. 10万元-30万元</label></div>
                        <div class="option"><label><input type="radio" name="q10" value="C"> C. 30万元-100万元</label></div>
                        <div class="option"><label><input type="radio" name="q10" value="D"> D. 100万元以上</label></div>
                        <div class="option"><label><input type="radio" name="q10" value="E"> E. 从未从事过金融市场投资</label></div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">四、投资目标</h2>
                
                <div class="question">
                    <div class="question-title">11. 您用于证券投资的大部分资金不会用作其它用途的时间段为：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q11" value="A" required> A. 0到1年</label></div>
                        <div class="option"><label><input type="radio" name="q11" value="B"> B. 1到5年</label></div>
                        <div class="option"><label><input type="radio" name="q11" value="C"> C. 无特别要求</label></div>
                    </div>
                </div>

                <div class="question">
                    <div class="question-title">12. 您打算重点投资于哪些种类的投资品种？</div>
                    <div class="options">
                        <div class="option"><label><input type="checkbox" name="q12" value="A"> A. 债券、货币市场基金、债券基金等固定收益类投资品种</label></div>
                        <div class="option"><label><input type="checkbox" name="q12" value="B"> B. 股票、混合型基金、偏股型基金、股票型基金等权益类投资品种</label></div>
                        <div class="option"><label><input type="checkbox" name="q12" value="C"> C. 期货、期权、融资融券等</label></div>
                        <div class="option"><label><input type="checkbox" name="q12" value="D"> D. 高风险金融产品或服务</label></div>
                        <div class="option"><label><input type="checkbox" name="q12" value="E"> E. 其他产品或服务</label></div>
                    </div>
                    <div class="multi-note">注：本题可多选，但评分以其中最高分值选项为准。</div>
                </div>

                <div class="question">
                    <div class="question-title">13. 假设有两种不同的投资：投资A期望获得5%的收益，有可能承担非常小的损失；投资B期望获得20%的收益，但有可能面临25%甚至更高的亏损。您将您的投资资产分配为：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q13" value="A" required> A. 全部投资于A</label></div>
                        <div class="option"><label><input type="radio" name="q13" value="B"> B. 大部分投资于A</label></div>
                        <div class="option"><label><input type="radio" name="q13" value="C"> C. 两种投资各一半</label></div>
                        <div class="option"><label><input type="radio" name="q13" value="D"> D. 大部分投资于B</label></div>
                        <div class="option"><label><input type="radio" name="q13" value="E"> E. 全部投资于B</label></div>
                    </div>
                </div>

                <div class="question">
                    <div class="question-title">14. 当您进行投资时，您的期望收益是：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q14" value="A" required> A. 尽可能保证本金安全，不在乎收益率比较低</label></div>
                        <div class="option"><label><input type="radio" name="q14" value="B"> B. 产生一定的收益，可以承担一定的投资风险</label></div>
                        <div class="option"><label><input type="radio" name="q14" value="C"> C. 产生较多的收益，可以承担较大的投资风险</label></div>
                        <div class="option"><label><input type="radio" name="q14" value="D"> D. 实现资产大幅增长，愿意承担很大的投资风险</label></div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">五、风险偏好</h2>
                
                <div class="question">
                    <div class="question-title">15. 您认为自己能承受的最大投资损失是多少？</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q15" value="A" required> A. 不能承受任何损失</label></div>
                        <div class="option"><label><input type="radio" name="q15" value="B"> B. 一定的投资损失</label></div>
                        <div class="option"><label><input type="radio" name="q15" value="C"> C. 较大的投资损失</label></div>
                        <div class="option"><label><input type="radio" name="q15" value="D"> D. 损失可能超过本金</label></div>
                    </div>
                </div>

                <div class="question">
                    <div class="question-title">16. 您打算将自己的投资回报主要用于：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q16" value="A" required> A. 改善生活</label></div>
                        <div class="option"><label><input type="radio" name="q16" value="B"> B. 个体生产经营或证券投资以外的投资行为</label></div>
                        <div class="option"><label><input type="radio" name="q16" value="C"> C. 履行扶养、抚养或赡养义务</label></div>
                        <div class="option"><label><input type="radio" name="q16" value="D"> D. 本人养老或医疗</label></div>
                        <div class="option"><label><input type="radio" name="q16" value="E"> E. 偿付债务</label></div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">六、其他信息</h2>
                
                <div class="question">
                    <div class="question-title">17. 您的年龄是：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q17" value="A" required> A. 18-30岁</label></div>
                        <div class="option"><label><input type="radio" name="q17" value="B"> B. 31-40岁</label></div>
                        <div class="option"><label><input type="radio" name="q17" value="C"> C. 41-50岁</label></div>
                        <div class="option"><label><input type="radio" name="q17" value="D"> D. 51-60岁</label></div>
                        <div class="option"><label><input type="radio" name="q17" value="E"> E. 超过60岁</label></div>
                    </div>
                </div>

                <div class="question">
                    <div class="question-title">18. 今后五年时间内，您的父母、配偶以及未成年子女等需负法定抚养、扶养和赡养义务的人数为：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q18" value="A" required> A. 1-2人</label></div>
                        <div class="option"><label><input type="radio" name="q18" value="B"> B. 3-4人</label></div>
                        <div class="option"><label><input type="radio" name="q18" value="C"> C. 5人以上</label></div>
                    </div>
                </div>

                <div class="question">
                    <div class="question-title">19. 您的最高学历是：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q19" value="A" required> A. 高中或以下</label></div>
                        <div class="option"><label><input type="radio" name="q19" value="B"> B. 大学专科</label></div>
                        <div class="option"><label><input type="radio" name="q19" value="C"> C. 大学本科</label></div>
                        <div class="option"><label><input type="radio" name="q19" value="D"> D. 硕士及以上</label></div>
                    </div>
                </div>

                <div class="question">
                    <div class="question-title">20. 您家庭的就业状况是：</div>
                    <div class="options">
                        <div class="option"><label><input type="radio" name="q20" value="A" required> A. 您与配偶均有稳定收入的工作</label></div>
                        <div class="option"><label><input type="radio" name="q20" value="B"> B. 您与配偶其中一人有稳定收入的工作</label></div>
                        <div class="option"><label><input type="radio" name="q20" value="C"> C. 您与配偶均没有稳定收入的工作或者已退休</label></div>
                        <div class="option"><label><input type="radio" name="q20" value="D"> D. 未婚，但有稳定收入的工作</label></div>
                        <div class="option"><label><input type="radio" name="q20" value="E"> E. 未婚，目前暂无稳定收入的工作</label></div>
                    </div>
                </div>
            </div>

            <div class="btn-container">
                <button type="button" id="calculate-btn">计算风险承受能力</button>
                <button type="button" id="submit-btn" style="display: none;">提交到飞书</button>
            </div>
        </form>

        <div class="result-container" id="result-container">
            <h2>风险评估结果</h2>
            <div class="score-display">您的得分：<span id="total-score">0</span> 分</div>
            <div class="risk-level">风险承受能力等级：<span id="risk-level">C1</span></div>
            
            <div class="match-info">
                <h3>风险等级与产品匹配说明</h3>
                <table>
                    <tr>
                        <th>风险承受能力等级</th>
                        <th>匹配产品风险等级</th>
                    </tr>
                    <tr>
                        <td>C1（含风险承受能力最低类别）</td>
                        <td>R1级</td>
                    </tr>
                    <tr>
                        <td>C2</td>
                        <td>R2、R1级</td>
                    </tr>
                    <tr>
                        <td>C3</td>
                        <td>R3、R2、R1级</td>
                    </tr>
                    <tr>
                        <td>C4</td>
                        <td>R4、R3、R2、R1级</td>
                    </tr>
                    <tr>
                        <td>C5</td>
                        <td>R5、R4、R3、R2、R1级</td>
                    </tr>
                </table>
            </div>

            <div class="signature">
                <p>本人已经了解并愿意遵守国家有关证券市场管理的法律、法规、规章及相关业务规则，本人在此郑重承诺以上填写的内容真实、准确、完整并对其负责。若本人提供的信息发生任何重大变化，本人将及时书面通知贵公司。</p>
                <p>投资者（签名）：________________________</p>
            </div>
        </div>

        <div class="submit-status" id="submit-status"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面加载完成，开始初始化...');
            
            const calculateBtn = document.getElementById('calculate-btn');
            const submitBtn = document.getElementById('submit-btn');
            const resultContainer = document.getElementById('result-container');
            const totalScoreElement = document.getElementById('total-score');
            const riskLevelElement = document.getElementById('risk-level');
            const submitStatus = document.getElementById('submit-status');
            
            console.log('DOM元素获取状态:', {
                calculateBtn: !!calculateBtn,
                submitBtn: !!submitBtn,
                resultContainer: !!resultContainer,
                totalScoreElement: !!totalScoreElement,
                riskLevelElement: !!riskLevelElement,
                submitStatus: !!submitStatus
            });
            
            // 飞书webhook地址和签名密钥
            const FEISHU_WEBHOOK = 'https://open.feishu.cn/open-apis/bot/v2/hook/049f39ab-7a60-4c4c-bc0d-312875cfde3f';
            const FEISHU_SECRET = '5J8dMRh2xO4EZazyCCRbph';
            
            // 评分标准
            const scoreMap = {
                '1': {'A': 3, 'B': 2, 'C': 1, 'D': 1, 'E': 0},
                '2': {'A': 1, 'B': 3, 'C': 4, 'D': 5, 'E': 6},
                '3': {'A': 3, 'B': 2, 'C': 1, 'D': 0},
                '4': {'A': 0, 'B': 1, 'C': 2, 'D': 3},
                '5': {'A': 5, 'B': 5, 'C': 5, 'D': 0},
                '6': {'A': 1, 'B': 2, 'C': 3, 'D': 5},
                '7': {'A': 1, 'B': 2, 'C': 3, 'D': 4},
                '8': {'A': 1, 'B': 3, 'C': 4, 'D': 6},
                '9': {'A': 0, 'B': 1, 'C': 2, 'D': 4, 'E': 6},
                '10': {'A': 1, 'B': 2, 'C': 3, 'D': 4, 'E': 0},
                '11': {'A': 1, 'B': 3, 'C': 5},
                '12': {'A': 2, 'B': 4, 'C': 5, 'D': 6, 'E': 6},
                '13': {'A': 0, 'B': 1, 'C': 3, 'D': 5, 'E': 6},
                '14': {'A': 0, 'B': 2, 'C': 3, 'D': 4},
                '15': {'A': 0, 'B': 2, 'C': 4, 'D': 6},
                '16': {'A': 7, 'B': 5, 'C': 4, 'D': 3, 'E': 1},
                '17': {'A': 5, 'B': 7, 'C': 3, 'D': 2, 'E': 0},
                '18': {'A': 5, 'B': 3, 'C': 1},
                '19': {'A': 1, 'B': 2, 'C': 4, 'D': 5},
                '20': {'A': 4, 'B': 3, 'C': 2, 'D': 5, 'E': 1}
            };

            // 问题标题映射
            const questionTitles = {
                '1': '主要收入来源',
                '2': '投资资金占比',
                '3': '债务情况',
                '4': '可投资资产',
                '5': '投资知识背景',
                '6': '投资经验',
                '7': '交易频率认知',
                '8': '产品服务数量',
                '9': '投资经验年限',
                '10': '月交易额',
                '11': '投资时间要求',
                '12': '重点投资品种',
                '13': '风险收益偏好',
                '14': '期望收益',
                '15': '最大损失承受',
                '16': '投资回报用途',
                '17': '年龄',
                '18': '抚养义务人数',
                '19': '最高学历',
                '20': '家庭就业状况'
            };

            // 选项内容映射
            const optionContents = {
                '1': {
                    'A': '工资、劳务报酬',
                    'B': '生产经营所得',
                    'C': '利息、股息、转让证券等金融性资产收入',
                    'D': '出租、出售房地产等非金融性资产收入',
                    'E': '无固定收入'
                },
                '2': {
                    'A': '70%以上',
                    'B': '50%-70%',
                    'C': '30%－50%',
                    'D': '10%－30%',
                    'E': '10%以下'
                },
                '3': {
                    'A': '没有',
                    'B': '有，住房抵押贷款等长期定额债务',
                    'C': '有，信用卡欠款、消费信贷等短期信用债务',
                    'D': '有，亲朋之间借款'
                },
                '4': {
                    'A': '不超过50万元人民币',
                    'B': '50万-300万元（不含）人民币',
                    'C': '300万-1000万元（不含）人民币',
                    'D': '1000万元人民币以上'
                },
                '5': {
                    'A': '现在或此前曾从事金融、经济或财会等与金融产品投资相关的工作超过两年',
                    'B': '已取得金融、经济或财会等与金融产品投资相关专业学士以上学位',
                    'C': '取得证券从业资格、基金从业资格、期货从业资格、注册会计师证书（CPA）或注册金融分析师证书（CFA）中的一项及以上',
                    'D': '我不符合以上任何一项描述'
                },
                '6': {
                    'A': '有限：除银行活期账户和定期存款外，我基本没有其他投资经验',
                    'B': '一般：除银行活期账户和定期存款外，我购买过基金、保险等理财产品，但还需要进一步的指导',
                    'C': '丰富：我是一位有经验的投资者，参与过股票、基金等产品的交易，并倾向于自己做出投资决策',
                    'D': '非常丰富：我是一位非常有经验的投资者，参与过权证、期货或创业板等产品的交易'
                },
                '7': {
                    'A': '太高了',
                    'B': '偏高',
                    'C': '正常',
                    'D': '偏低'
                },
                '8': {
                    'A': '5个以下',
                    'B': '6至10个',
                    'C': '11至15个',
                    'D': '16个以上'
                },
                '9': {
                    'A': '银行存款等',
                    'B': '债券、货币市场基金、债券型基金或其它固定收益类产品等',
                    'C': '股票、混合型基金、偏股型基金、股票型基金等权益类投资品种等',
                    'D': '期货、期权、融资融券',
                    'E': '复杂金融产品、其他产品或服务'
                },
                '10': {
                    'A': '10万元以内',
                    'B': '10万元-30万元',
                    'C': '30万元-100万元',
                    'D': '100万元以上',
                    'E': '从未从事过金融市场投资'
                },
                '11': {
                    'A': '0到1年',
                    'B': '1到5年',
                    'C': '无特别要求'
                },
                '12': {
                    'A': '债券、货币市场基金、债券基金等固定收益类投资品种',
                    'B': '股票、混合型基金、偏股型基金、股票型基金等权益类投资品种',
                    'C': '期货、期权、融资融券等',
                    'D': '高风险金融产品或服务',
                    'E': '其他产品或服务'
                },
                '13': {
                    'A': '全部投资于A',
                    'B': '大部分投资于A',
                    'C': '两种投资各一半',
                    'D': '大部分投资于B',
                    'E': '全部投资于B'
                },
                '14': {
                    'A': '尽可能保证本金安全，不在乎收益率比较低',
                    'B': '产生一定的收益，可以承担一定的投资风险',
                    'C': '产生较多的收益，可以承担较大的投资风险',
                    'D': '实现资产大幅增长，愿意承担很大的投资风险'
                },
                '15': {
                    'A': '不能承受任何损失',
                    'B': '一定的投资损失',
                    'C': '较大的投资损失',
                    'D': '损失可能超过本金'
                },
                '16': {
                    'A': '改善生活',
                    'B': '个体生产经营或证券投资以外的投资行为',
                    'C': '履行扶养、抚养或赡养义务',
                    'D': '本人养老或医疗',
                    'E': '偿付债务'
                },
                '17': {
                    'A': '18-30岁',
                    'B': '31-40岁',
                    'C': '41-50岁',
                    'D': '51-60岁',
                    'E': '超过60岁'
                },
                '18': {
                    'A': '1-2人',
                    'B': '3-4人',
                    'C': '5人以上'
                },
                '19': {
                    'A': '高中或以下',
                    'B': '大学专科',
                    'C': '大学本科',
                    'D': '硕士及以上'
                },
                '20': {
                    'A': '您与配偶均有稳定收入的工作',
                    'B': '您与配偶其中一人有稳定收入的工作',
                    'C': '您与配偶均没有稳定收入的工作或者已退休',
                    'D': '未婚，但有稳定收入的工作',
                    'E': '未婚，目前暂无稳定收入的工作'
                }
            };
            
            calculateBtn.addEventListener('click', function() {
                console.log('计算按钮被点击');
                // 检查所有必填项是否已填写
                const requiredInputs = document.querySelectorAll('input[required]');
                let allFilled = true;
                
                requiredInputs.forEach(input => {
                    if (!input.value && input.type === 'text') {
                        allFilled = false;
                        input.style.borderColor = 'red';
                    } else if (input.type === 'radio' || input.type === 'checkbox') {
                        const name = input.name;
                        const checked = document.querySelectorAll(`input[name="${name}"]:checked`).length > 0;
                        if (!checked) {
                            allFilled = false;
                            // 高亮显示未回答的问题
                            const question = input.closest('.question');
                            question.style.borderLeftColor = 'red';
                        }
                    }
                });
                
                if (!allFilled) {
                    alert('请填写所有必填项');
                    return;
                }
                
                // 计算总分
                let totalScore = 0;
                
                // 处理单选题
                for (let i = 1; i <= 20; i++) {
                    if (i === 9 || i === 12) continue; // 跳过多选题
                    
                    const selected = document.querySelector(`input[name="q${i}"]:checked`);
                    if (selected) {
                        totalScore += scoreMap[i][selected.value];
                    }
                }
                
                // 处理多选题（第9题和第12题）
                const multiQuestions = [9, 12];
                multiQuestions.forEach(q => {
                    const selectedOptions = document.querySelectorAll(`input[name="q${q}"]:checked`);
                    let maxScore = 0;
                    
                    selectedOptions.forEach(option => {
                        const score = scoreMap[q][option.value];
                        if (score > maxScore) {
                            maxScore = score;
                        }
                    });
                    
                    totalScore += maxScore;
                });
                
                // 确定风险等级
                let riskLevel = '';
                const q15Answer = document.querySelector('input[name="q15"]:checked').value;
                
                if (q15Answer === 'A') {
                    riskLevel = 'C1（含风险承受能力最低类别的投资者）';
                } else if (totalScore < 20) {
                    riskLevel = 'C1（不含风险承受能力最低类别的投资者）';
                } else if (totalScore >= 20 && totalScore <= 36) {
                    riskLevel = 'C2';
                } else if (totalScore >= 37 && totalScore <= 53) {
                    riskLevel = 'C3';
                } else if (totalScore >= 54 && totalScore <= 82) {
                    riskLevel = 'C4';
                } else {
                    riskLevel = 'C5';
                }
                
                // 显示结果
                totalScoreElement.textContent = totalScore;
                riskLevelElement.textContent = riskLevel;
                resultContainer.style.display = 'block';
                submitBtn.style.display = 'inline-block';
                
                // 滚动到结果部分
                resultContainer.scrollIntoView({ behavior: 'smooth' });
            });

            submitBtn.addEventListener('click', function() {
                console.log('提交按钮被点击');
                submitToFeishu();
            });

            function submitToFeishu() {
                console.log('开始提交到飞书...');
                // 收集所有表单数据
                const formData = {
                    name: document.querySelector('input[name="name"]').value,
                    idType: document.querySelector('input[name="id-type"]').value,
                    idNumber: document.querySelector('input[name="id-number"]').value,
                    date: document.querySelector('input[name="date"]').value,
                    totalScore: document.getElementById('total-score').textContent,
                    riskLevel: document.getElementById('risk-level').textContent,
                    answers: {},
                    timestamp: new Date().toLocaleString('zh-CN')
                };
                
                console.log('表单数据收集完成:', formData);

                // 收集所有问题的答案
                for (let i = 1; i <= 20; i++) {
                    const questionName = `q${i}`;
                    const inputs = document.querySelectorAll(`input[name="${questionName}"]`);
                    
                    if (inputs[0].type === 'checkbox') {
                        // 多选题
                        const selectedValues = [];
                        const selectedContents = [];
                        inputs.forEach(input => {
                            if (input.checked) {
                                selectedValues.push(input.value);
                                selectedContents.push(optionContents[i][input.value]);
                            }
                        });
                        formData.answers[i] = {
                            question: questionTitles[i],
                            type: 'checkbox',
                            selected: selectedValues,
                            selectedContents: selectedContents,
                            score: Math.max(...selectedValues.map(v => scoreMap[i][v]))
                        };
                    } else {
                        // 单选题
                        const selected = document.querySelector(`input[name="${questionName}"]:checked`);
                        if (selected) {
                            formData.answers[i] = {
                                question: questionTitles[i],
                                type: 'radio',
                                selected: selected.value,
                                selectedContent: optionContents[i][selected.value],
                                score: scoreMap[i][selected.value]
                            };
                        }
                    }
                }

                // 构建飞书消息（异步生成签名）
                buildFeishuMessage(formData).then(feishuMessage => {
                    // 发送到飞书
                    fetch(FEISHU_WEBHOOK, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(feishuMessage)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.code === 0) {
                            showSubmitStatus('提交成功！结果已发送到飞书群。', 'success');
                            submitBtn.disabled = true;
                            submitBtn.textContent = '已提交';
                        } else {
                            showSubmitStatus('提交失败：' + (data.msg || '未知错误'), 'error');
                        }
                    })
                    .catch(error => {
                        console.error('提交失败:', error);
                        showSubmitStatus('提交失败：网络错误，请稍后重试', 'error');
                    });
                }).catch(error => {
                    console.error('构建消息失败:', error);
                    showSubmitStatus('构建消息失败，请稍后重试', 'error');
                });
            }

            async function buildFeishuMessage(formData) {
                // 构建答案详情
                let answersDetail = '';
                for (let i = 1; i <= 20; i++) {
                    if (formData.answers[i]) {
                        const answer = formData.answers[i];
                        if (answer.type === 'checkbox') {
                            answersDetail += `${i}. ${answer.question}：${answer.selected.join('、')}\n   内容：${answer.selectedContents.join('、')}\n   得分：${answer.score}\n\n`;
                        } else {
                            answersDetail += `${i}. ${answer.question}：${answer.selected}\n   内容：${answer.selectedContent}\n   得分：${answer.score}\n\n`;
                        }
                    }
                }

                // 生成时间戳和签名
                const timestamp = Math.floor(Date.now() / 1000);
                const signature = await generateSignature(FEISHU_SECRET, timestamp);

                return {
                    timestamp: timestamp,
                    sign: signature,
                    msg_type: "post",
                    content: {
                        post: {
                            zh_cn: {
                                title: "🎯 投资者风险评估结果",
                                content: [
                                    [
                                        {
                                            tag: "text",
                                            text: `📋 投资者信息\n`
                                        },
                                        {
                                            tag: "text",
                                            text: `姓名：${formData.name}\n`
                                        },
                                        {
                                            tag: "text",
                                            text: `证件类型：${formData.idType}\n`
                                        },
                                        {
                                            tag: "text",
                                            text: `证件号码：${formData.idNumber}\n`
                                        },
                                        {
                                            tag: "text",
                                            text: `签署日期：${formData.date}\n\n`
                                        },
                                        {
                                            tag: "text",
                                            text: `📊 评估结果\n`
                                        },
                                        {
                                            tag: "text",
                                            text: `总分：${formData.totalScore} 分\n`
                                        },
                                        {
                                            tag: "text",
                                            text: `风险等级：${formData.riskLevel}\n\n`
                                        },
                                        {
                                            tag: "text",
                                            text: `📝 详细答案\n`
                                        },
                                        {
                                            tag: "text",
                                            text: answersDetail
                                        },
                                        {
                                            tag: "text",
                                            text: `⏰ 提交时间：${formData.timestamp}`
                                        }
                                    ]
                                ]
                            }
                        }
                    }
                };
            }

            // 生成飞书签名
            async function generateSignature(secret, timestamp) {
                try {
                    // 把timestamp+"\n"+密钥当做签名字符串（作为密钥）
                    const stringToSign = timestamp + "\n" + secret;
                    
                    // 使用 CryptoJS 生成 HMAC-SHA256 签名
                    // 根据Java代码：stringToSign作为密钥，空字符串作为消息
                    if (typeof CryptoJS !== 'undefined') {
                        const hmac = CryptoJS.HmacSHA256("", stringToSign);
                        return CryptoJS.enc.Base64.stringify(hmac);
                    }
                    
                    // 备用方法：使用 Web Crypto API
                    if (window.crypto && window.crypto.subtle) {
                        return await generateHmacSha256("", stringToSign);
                    }
                    
                    // 最后的备用方法（仅用于测试）
                    return btoa(stringToSign);
                } catch (error) {
                    console.error('签名生成失败:', error);
                    return '';
                }
            }

            // 使用 Web Crypto API 生成 HMAC-SHA256 签名（备用方法）
            async function generateHmacSha256(message, secret) {
                try {
                    const encoder = new TextEncoder();
                    const keyData = encoder.encode(secret);
                    const messageData = encoder.encode(message);
                    
                    const key = await crypto.subtle.importKey(
                        'raw',
                        keyData,
                        { name: 'HMAC', hash: 'SHA-256' },
                        false,
                        ['sign']
                    );
                    
                    const signature = await crypto.subtle.sign('HMAC', key, messageData);
                    return btoa(String.fromCharCode(...new Uint8Array(signature)));
                } catch (error) {
                    console.warn('HMAC-SHA256 生成失败，使用备用方法:', error);
                    return btoa(message + '_' + secret);
                }
            }

            function showSubmitStatus(message, type) {
                submitStatus.textContent = message;
                submitStatus.className = `submit-status submit-${type}`;
                submitStatus.style.display = 'block';
                
                // 3秒后自动隐藏
                setTimeout(() => {
                    submitStatus.style.display = 'none';
                }, 3000);
            }
        });
    </script>
</body>
</html>
